<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRMP Infinity 2030</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body>
    <div class="app-shell">
        <aside class="sidebar">
            <div class="logo-brand">CRMP ∞</div>
            <nav>
                <button onclick="showPage('invoice')" class="nav-item active">📄 הפקה</button>
                <button onclick="showPage('clients')" class="nav-item">👥 לקוחות</button>
                <button onclick="showPage('archive')" class="nav-item">📊 ארכיון</button>
                <button onclick="backupData()" class="nav-item" style="margin-top: auto;">💾 גיבוי</button>
            </nav>
        </aside>

        <main class="content-area">
            <section id="page-invoice" class="page active">
                <div class="glass-card main-invoice" id="invoice-content">
                    <header class="invoice-header">
                        <div class="biz-info">
                            <div class="logo-box" onclick="document.getElementById('logo-upload').click()">
                                <img id="user-logo" src="https://via.placeholder.com/100" alt="לוגו">
                                <input type="file" id="logo-upload" hidden accept="image/*" onchange="previewLogo(event)">
                            </div>
                            <input type="text" id="biz-name" placeholder="שם העסק שלך" class="input-minimal biz-title">
                        </div>
                        <div class="doc-info">
                            <h1 id="doc-title-display">חשבונית מס</h1>
                            <p>מספר: <span id="doc-num">1001</span></p>
                        </div>
                    </header>

                    <div class="invoice-body">
                        <div class="row-grid">
                            <select id="doc-type" onchange="updateDocType()">
                                <option>חשבונית מס</option>
                                <option>הצעת מחיר</option>
                            </select>
                            <select id="client-select-main"></select>
                        </div>
                        <table class="modern-table">
                            <thead><tr><th>תיאור</th><th>כמות</th><th>מחיר</th><th>סה"כ</th></tr></thead>
                            <tbody id="items-body">
                                <tr>
                                    <td><input type="text" class="input-minimal" placeholder="שירות/מוצר"></td>
                                    <td><input type="number" class="input-minimal qty" value="1" oninput="calculate()"></td>
                                    <td><input type="number" class="input-minimal price" value="0" oninput="calculate()"></td>
                                    <td class="row-total">0.00 ₪</td>
                                </tr>
                            </tbody>
                        </table>
                        <button class="btn-add" onclick="addRow()">+ הוסף שורה</button>
                    </div>

                    <div class="invoice-footer">
                        <div class="signature-box">
                            <canvas id="sig-canvas"></canvas>
                        </div>
                        <div class="summary-box">
                            <p>לפני מע"מ: <span id="subtotal">0.00</span> ₪</p>
                            <h3>סה"כ: <span id="total">0.00</span> ₪</h3>
                        </div>
                    </div>
                </div>
                <div class="actions-floating">
                    <button class="btn-primary" onclick="generatePDF()">הפק PDF</button>
                </div>
            </section>

            <section id="page-clients" class="page">
                <div class="page-header">
                    <h2>ניהול לקוחות 2030</h2>
                    <button class="btn-primary" onclick="openClientModal()">+ לקוח חדש</button>
                </div>
                <div class="search-bar">
                    <input type="text" id="client-search" placeholder="חפש לקוח..." oninput="filterClients()">
                </div>
                <div class="client-grid" id="client-list">
                    </div>
            </section>

            <section id="page-archive" class="page">
                <h2>ארכיון מסמכים</h2>
                <div class="glass-card">
                    <table class="modern-table">
                        <thead><tr><th>מספר</th><th>לקוח</th><th>סכום</th><th>תאריך</th></tr></thead>
                        <tbody id="archive-list"></tbody>
                    </table>
                </div>
            </section>
        </main>
    </div>

    <div id="client-modal" class="modal">
        <div class="modal-content glass-card">
            <h3>פרטי לקוח חדש</h3>
            <input type="text" id="new-client-name" placeholder="שם מלא">
            <input type="text" id="new-client-email" placeholder="אימייל">
            <input type="text" id="new-client-phone" placeholder="טלפון">
            <div class="modal-btns">
                <button onclick="saveClient()" class="btn-primary">שמור</button>
                <button onclick="closeClientModal()" class="btn-text">ביטול</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
